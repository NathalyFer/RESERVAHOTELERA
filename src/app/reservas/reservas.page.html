<ion-header>
  <ion-toolbar>
    <ion-title>Crear Reserva</ion-title>
    <ion-buttons slot="end">
      <ion-button routerLink="/lista-reservas">
        <ion-icon name="list-outline" slot="start"></ion-icon>
        Ver reservas
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content fullscreen>
  <div class="page">
    <!-- Encabezado -->
    <div class="hero">
      <ion-icon name="bed-outline" class="hero-icon"></ion-icon>
      <div class="hero-text">
        <h1>Nueva Reserva</h1>
        <p>Completa los datos del cliente, habitación y fechas.</p>
      </div>
    </div>

    <ion-card class="glass">
      <ion-card-header>
        <ion-card-title>Datos de la reserva</ion-card-title>
        <ion-card-subtitle>Todos los campos con * son obligatorios</ion-card-subtitle>
      </ion-card-header>

      <ion-card-content>
        <form (ngSubmit)="guardar()" #reservaForm="ngForm" novalidate>

          <!-- Cliente / Habitación -->
          <ion-grid class="grid-gap">
            <ion-row>
              <ion-col size="12" sizeMd="6">
                <ion-item class="field" fill="outline">
                  <ion-icon name="person-outline" slot="start"></ion-icon>
                  <ion-label position="floating">Cliente ID *</ion-label>
                  <ion-input
                    type="number"
                    inputmode="numeric"
                    name="cliente_id"
                    [(ngModel)]="form.cliente_id"
                    required
                    min="1"
                    clear-input>
                  </ion-input>
                </ion-item>
                <ion-note color="danger" *ngIf="reservaForm.submitted && (!form.cliente_id || form.cliente_id < 1)">
                  Debes ingresar un Cliente ID válido.
                </ion-note>
              </ion-col>

              <ion-col size="12" sizeMd="6">
                <ion-item class="field" fill="outline">
                  <ion-icon name="home-outline" slot="start"></ion-icon>
                  <ion-label position="floating">Habitación ID *</ion-label>
                  <ion-input
                    type="number"
                    inputmode="numeric"
                    name="habitacion_id"
                    [(ngModel)]="form.habitacion_id"
                    required
                    min="1"
                    clear-input>
                  </ion-input>
                </ion-item>
                <ion-note color="danger" *ngIf="reservaForm.submitted && (!form.habitacion_id || form.habitacion_id < 1)">
                  Debes ingresar una Habitación ID válida.
                </ion-note>
              </ion-col>
            </ion-row>
          </ion-grid>

          <!-- Fechas (compactas con input type="date") -->
          <ion-grid class="grid-gap">
            <ion-row>
              <ion-col size="12" sizeMd="6">
                <ion-item class="field" fill="outline">
                  <ion-icon name="calendar-clear-outline" slot="start"></ion-icon>
                  <ion-label position="stacked">Fecha de entrada *</ion-label>
                  <ion-input
                    type="date"
                    name="fecha_entrada"
                    [(ngModel)]="form.fecha_entrada"
                    [min]="minDate">
                  </ion-input>
                </ion-item>
              </ion-col>

              <ion-col size="12" sizeMd="6">
                <ion-item class="field" fill="outline">
                  <ion-icon name="calendar-outline" slot="start"></ion-icon>
                  <ion-label position="stacked">Fecha de salida *</ion-label>
                  <ion-input
                    type="date"
                    name="fecha_salida"
                    [(ngModel)]="form.fecha_salida"
                    [min]="minDate">
                  </ion-input>
                </ion-item>
              </ion-col>
            </ion-row>
          </ion-grid>

          <ion-note color="danger" *ngIf="reservaForm.submitted && (!form.fecha_entrada || !form.fecha_salida)">
            Debes seleccionar ambas fechas.
          </ion-note>
          <ion-note
            color="danger"
            *ngIf="reservaForm.submitted && form.fecha_entrada && form.fecha_salida && (form.fecha_salida.slice(0,10) < form.fecha_entrada.slice(0,10))">
            La fecha de salida no puede ser menor a la de entrada.
          </ion-note>

          <!-- Personas / Estado -->
          <ion-grid class="grid-gap">
            <ion-row>
              <ion-col size="12" sizeMd="6">
                <ion-item class="field" fill="outline">
                  <ion-icon name="people-outline" slot="start"></ion-icon>
                  <ion-label position="floating">Cantidad de personas</ion-label>
                  <ion-input
                    type="number"
                    inputmode="numeric"
                    name="cantidad_personas"
                    [(ngModel)]="form.cantidad_personas"
                    min="1">
                  </ion-input>
                </ion-item>
                <ion-note color="medium">Mínimo 1. Ajusta según disponibilidad de la habitación.</ion-note>
              </ion-col>

              <ion-col size="12" sizeMd="6">
                <ion-item class="field" fill="outline">
                  <ion-icon name="flag-outline" slot="start"></ion-icon>
                  <ion-label position="stacked">Estado</ion-label>
                  <ion-select
                    interface="popover"
                    name="estado_reserva"
                    [(ngModel)]="form.estado_reserva">
                    <ion-select-option value="pendiente">Pendiente</ion-select-option>
                    <ion-select-option value="confirmada">Confirmada</ion-select-option>
                    <ion-select-option value="cancelada">Cancelada</ion-select-option>
                  </ion-select>
                </ion-item>
              </ion-col>
            </ion-row>
          </ion-grid>

          <!-- Acciones -->
          <div class="actions">
            <ion-button
              type="submit"
              size="large"
              shape="round"
              class="btn-guardar"
              [disabled]="!form.cliente_id || !form.habitacion_id || !form.fecha_entrada || !form.fecha_salida">
              <ion-icon name="save-outline" slot="start"></ion-icon>
              Guardar reserva
            </ion-button>

            <ion-button
              fill="clear"
              size="large"
              shape="round"
              color="medium"
              routerLink="/lista-reservas">
              <ion-icon name="list-outline" slot="start"></ion-icon>
              Ver reservas
            </ion-button>
          </div>

          <ion-note color="medium" class="footnote">
            Al guardar, te llevamos automáticamente al listado para que verifiques la reserva creada.
          </ion-note>
        </form>
      </ion-card-content>
    </ion-card>
  </div>
</ion-content>
